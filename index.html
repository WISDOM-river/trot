<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ã‚¿ãƒ­ãƒƒãƒˆå ã„</title>
  <style>
    :root{ --border:#ddd; --bg:#fafafa; --ink:#111; --muted:#666; }
    body{
      font-family: system-ui, -apple-system, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      margin:0; color:var(--ink); background:#fff;
    }
    .wrap{ max-width: 820px; margin:0 auto; padding:16px; }
    h1{ font-size:22px; margin:0 0 12px; }
    .card{ border:1px solid var(--border); border-radius: 12px; padding: 14px; background: var(--bg); }

    .btns{ display:flex; gap:10px; flex-wrap: wrap; }
    button{
      padding: 10px 14px; border: 1px solid #bbb; border-radius: 10px;
      background: #fff; cursor: pointer; font-size: 15px;
    }
    button:hover{ background:#f2f2f2; }

    .meta{ font-size: 12px; color: var(--muted); margin-top: 10px; line-height: 1.7; }

    .status{
      margin-top: 12px; font-size: 14px; padding: 10px; border-radius: 10px;
      border: 1px solid var(--border); background:#fff;
    }
    .ok{ border-color:#bfe3c2; background:#f1fbf2; }
    .ng{ border-color:#f1b6b6; background:#fff3f3; }

    /* æ¨ªä¸¦ã³å…¥åŠ› */
    .inputs{ margin-top:12px; display:grid; gap:10px; }
    .inputRow{ display:grid; gap:10px; grid-template-columns: 1fr; }
    @media (min-width: 640px){
      .inputRow{ grid-template-columns: 1fr 1fr 1fr; }
    }
    label{ font-size: 13px; color:#444; display:block; margin-bottom: 4px; }
    input[type="number"]{
      width:100%; padding: 10px; border: 1px solid var(--border); border-radius: 10px;
      font-size: 16px; background:#fff; box-sizing: border-box;
    }

    .section{ margin-top: 14px; }
    .section h2{ font-size: 14px; margin: 0 0 8px; color:#333; }
    .resultBox{
      border:1px solid var(--border); border-radius: 12px; background:#fff; padding: 12px;
      line-height: 1.8; font-size: 15px;
      white-space: pre-wrap;
    }

    textarea{
      width: 100%; resize: vertical;
      padding: 12px; border: 1px solid var(--border); border-radius: 12px;
      font-size: 14px; background:#fff; box-sizing: border-box;
      line-height: 1.7;
    }
    #info{ min-height: 280px; }

    .headRow{ display:flex; align-items:center; justify-content: space-between; gap:10px; margin-bottom: 8px; flex-wrap: wrap; }
    .headRow .right{ display:flex; gap:10px; flex-wrap: wrap; }
    .toast{
      position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);
      background: rgba(0,0,0,.85); color:#fff; padding: 10px 12px; border-radius: 12px;
      font-size: 13px; opacity: 0; pointer-events: none; transition: opacity .18s ease;
    }
    .toast.show{ opacity: 1; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ã‚¿ãƒ­ãƒƒãƒˆå ã„</h1>

    <div class="card">
      <div class="btns">
        <button id="shuffleBtn">ğŸ”€ ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
        <button id="flipBtn">ğŸƒ ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</button>
        <button id="resetBtn">â†©ï¸ ãƒªã‚»ãƒƒãƒˆ</button>
      </div>

      <div class="meta">
        ãƒ»ç•ªå·ã¯ <b>1ã€œ156</b>ï¼ˆ78æšÃ—æ­£ä½ç½®/é€†ä½ç½®ï¼‰<br/>
        ãƒ»ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œã¯ã€Œå±±æœ­ã®ä½ç½®ã€ã«ãªã‚‹ï¼ˆä¾‹ï¼šç•ªå·5ï¼å±±æœ­ã®5æšç›®ï¼‰<br/>
        ãƒ»ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã¯ <b>æ‰‹å…¥åŠ›ã§è¿½è¨˜ãƒ»å‰Šé™¤OK</b>ï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰
      </div>

      <div class="inputs">
        <div class="inputRow">
          <div>
            <label for="n1">ç•ªå·1ï¼ˆ1ã€œ156ï¼‰</label>
            <input id="n1" type="number" min="1" max="156" placeholder="ä¾‹ï¼š1" />
          </div>
          <div>
            <label for="n2">ç•ªå·2ï¼ˆ1ã€œ156ï¼‰</label>
            <input id="n2" type="number" min="1" max="156" placeholder="ä¾‹ï¼š78" />
          </div>
          <div>
            <label for="n3">ç•ªå·3ï¼ˆ1ã€œ156ï¼‰</label>
            <input id="n3" type="number" min="1" max="156" placeholder="ä¾‹ï¼š156" />
          </div>
        </div>

        <div>
          <div id="status" class="status ok">æœªã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆåˆæœŸé †ï¼‰</div>
        </div>
      </div>

      <div class="section">
        <h2>ã‚ãã£ãŸçµæœ</h2>
        <div id="resultBox" class="resultBox">ï¼ˆã¾ã ã§ã™ï¼‰</div>
      </div>

      <div class="section">
        <div class="headRow">
          <h2 style="margin:0;">ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆç·¨é›†OKï¼‰</h2>
          <div class="right">
            <button id="copyInfoBtn">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>
            <button id="regenBtn">â™»ï¸ å†ç”Ÿæˆï¼ˆä¸Šæ›¸ãï¼‰</button>
          </div>
        </div>
        <textarea id="info" placeholder="ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹ã¨ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ç”Ÿæˆã€‚ã“ã“ã¯è‡ªç”±ã«ç·¨é›†ã—ã¦OKã€‚"></textarea>
        <div class="meta">â€»ã€Œå†ç”Ÿæˆï¼ˆä¸Šæ›¸ãï¼‰ã€ã¯ã€ä»Šã®ç·¨é›†å†…å®¹ã‚’æ¨ã¦ã¦ã€æœ€æ–°ã®å¼•ã„ãŸã‚«ãƒ¼ãƒ‰ã§ãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ä½œã‚Šç›´ã—ã¾ã™ã€‚</div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆ</div>

  <script>
    // =========================
    // 78æšï¼ˆæ—¥æœ¬èªï¼šæ­£è¦è¡¨è¨˜ï¼‰
    // =========================
    const major = [
      "æ„šè€…","é­”è¡“å¸«","å¥³æ•™çš‡","å¥³å¸","çš‡å¸","æ•™çš‡","æ‹äºº","æˆ¦è»Š","åŠ›","éš è€…","é‹å‘½ã®è¼ª",
      "æ­£ç¾©","åŠã‚‹ã•ã‚ŒãŸç”·","æ­»ç¥","ç¯€åˆ¶","æ‚ªé­”","å¡”","æ˜Ÿ","æœˆ","å¤ªé™½","å¯©åˆ¤","ä¸–ç•Œ"
    ];

    const suits = [
      { key:"wands", jp:"ãƒ¯ãƒ³ãƒ‰" },
      { key:"cups", jp:"ã‚«ãƒƒãƒ—" },
      { key:"swords", jp:"ã‚½ãƒ¼ãƒ‰" },
      { key:"pentacles", jp:"ãƒšãƒ³ã‚¿ã‚¯ãƒ«" }
    ];

    const ranks = [
      { key:"A", jp:"ã‚¨ãƒ¼ã‚¹" },
      { key:"2", jp:"2" },{ key:"3", jp:"3" },{ key:"4", jp:"4" },{ key:"5", jp:"5" },
      { key:"6", jp:"6" },{ key:"7", jp:"7" },{ key:"8", jp:"8" },{ key:"9", jp:"9" },{ key:"10", jp:"10" },
      { key:"Page", jp:"ãƒšã‚¤ã‚¸" },
      { key:"Knight", jp:"ãƒŠã‚¤ãƒˆ" },
      { key:"Queen", jp:"ã‚¯ã‚¤ãƒ¼ãƒ³" },
      { key:"King", jp:"ã‚­ãƒ³ã‚°" }
    ];

    function build78() {
      const base = [];
      for (const name of major) base.push({ arcana:"major", name });

      for (const s of suits) {
        for (const r of ranks) {
          base.push({
            arcana:"minor",
            suitKey: s.key,
            suitJP: s.jp,
            rankKey: r.key,
            rankJP: r.jp,
            name: `${s.jp}ã®${r.jp}`
          });
        }
      }
      return base; // 78
    }

    function build156() {
      const base78 = build78();
      const all = [];
      for (const c of base78) {
        all.push({ ...c, pos:"æ­£ä½ç½®" });
        all.push({ ...c, pos:"é€†ä½ç½®" });
      }
      return all; // 156
    }

    // Fisherâ€“Yates shuffle
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // =========================
    // UI helpers
    // =========================
    const originalDeck = build156();
    let deck = originalDeck.map(x => ({...x}));
    let shuffled = false;

    const $ = (id) => document.getElementById(id);
    const statusEl = $("status");
    const resultBoxEl = $("resultBox");
    const infoEl = $("info");
    const toastEl = $("toast");

    function showToast(msg="ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆ") {
      toastEl.textContent = msg;
      toastEl.classList.add("show");
      setTimeout(() => toastEl.classList.remove("show"), 1100);
    }

    function setStatus(msg, ok=true) {
      statusEl.textContent = msg;
      statusEl.classList.remove("ok","ng");
      statusEl.classList.add(ok ? "ok" : "ng");
    }

    function readNums() {
      return [$("n1").value, $("n2").value, $("n3").value].map(v => Number(v));
    }

    function validateNums(nums) {
      if (nums.some(n => !Number.isInteger(n))) {
        return { ok:false, msg:"ç•ªå·ã¯3ã¤ã¨ã‚‚æ•´æ•°ã§å…¥åŠ›ã—ã¦ã­ï¼ˆ1ã€œ156ï¼‰ã€‚" };
      }
      if (nums.some(n => n < 1 || n > 156)) {
        return { ok:false, msg:"ç¯„å›²å¤–ã‚ã‚Šã€‚ç•ªå·ã¯ 1ã€œ156 ã§å…¥åŠ›ã—ã¦ã­ã€‚" };
      }
      const set = new Set(nums);
      if (set.size !== nums.length) {
        return { ok:false, msg:"ç•ªå·ãŒé‡è¤‡ã—ã¦ã‚‹ã‚ˆã€‚3ã¤ã¨ã‚‚åˆ¥ã®ç•ªå·ã«ã—ã¦ã­ã€‚" };
      }
      return { ok:true, msg:"OK" };
    }

    function formatCardLine(i, card){
      return `ã‚«ãƒ¼ãƒ‰${i}ï¼š${card.name}ï¼ˆ${card.pos}ï¼‰`;
    }

    function buildTemplate() {
      return [
        `â—¾ï¸ä¸Šã®ã‚«ãƒ¼ãƒ‰ã§å ã£ã¦`,
        `ãƒ»æ˜æ—¥ã®é‹å‹¢`,
        `ãƒ»ãƒ©ãƒƒã‚­ãƒ¼ã‚¢ã‚¤ãƒ†ãƒ `,
        `ãƒ»ã‚­ãƒ£ãƒƒãƒãƒ•ãƒ¬ãƒ¼ã‚º`,
        `ãƒ»é‡‘é‹`,
        `ãƒ»é€²ã‚€ï¼æ­¢ã¾ã‚‹ã€€ã©ã£ã¡ï¼Ÿ`,
        `ãƒ»ç·åˆç‚¹ã€€â˜…10å€‹ä¸­ä½•å€‹ï¼Ÿ`
      ].join("\n");
    }

    function buildInfoText(resultText){
      return [resultText, buildTemplate()].join("\n\n");
    }

    async function copyText(text) {
      try {
        await navigator.clipboard.writeText(text);
        showToast("ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆ");
      } catch (e) {
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        document.body.removeChild(ta);
        showToast("ã‚³ãƒ”ãƒ¼ã—ãŸã‚ˆ");
      }
    }

    // ã€Œå†ç”Ÿæˆï¼ˆä¸Šæ›¸ãï¼‰ã€ç”¨ã«ä¿æŒ
    let lastPicked = null;
    let lastResultText = "";

    function regenerateInfo(){
      if (!lastPicked || !lastResultText) return false;
      infoEl.value = buildInfoText(lastResultText);
      return true;
    }

    // =========================
    // Actions
    // =========================
    $("shuffleBtn").addEventListener("click", () => {
      deck = originalDeck.map(x => ({...x}));
      shuffleArray(deck);
      shuffled = true;

      resultBoxEl.textContent = "ï¼ˆã¾ã ã§ã™ï¼‰";
      infoEl.value = "";
      lastPicked = null;
      lastResultText = "";

      setStatus("ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¸ˆã¿ï¼šå±±æœ­ã‚’æ›´æ–°ã—ãŸã‚ˆ", true);
    });

    $("resetBtn").addEventListener("click", () => {
      deck = originalDeck.map(x => ({...x}));
      shuffled = false;

      resultBoxEl.textContent = "ï¼ˆã¾ã ã§ã™ï¼‰";
      infoEl.value = "";
      lastPicked = null;
      lastResultText = "";

      setStatus("æœªã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆåˆæœŸé †ï¼‰ã«æˆ»ã—ãŸã‚ˆ", true);
    });

    $("flipBtn").addEventListener("click", () => {
      const nums = readNums();
      const v = validateNums(nums);
      if (!v.ok) {
        setStatus(v.msg, false);
        return;
      }

      const picked = nums.map(n => deck[n - 1]); // card objects
      const resultText = [
        formatCardLine(1, picked[0]),
        formatCardLine(2, picked[1]),
        formatCardLine(3, picked[2]),
      ].join("\n");

      resultBoxEl.textContent = resultText;

      lastPicked = picked;
      lastResultText = resultText;

      // ã“ã“ã§ãƒ†ãƒ³ãƒ—ãƒ¬ç”Ÿæˆï¼ˆä»¥å¾Œã¯è‡ªç”±ã«ç·¨é›†OKï¼‰
      infoEl.value = buildInfoText(resultText);

      setStatus(
        shuffled
          ? "ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ¸ˆã¿ã®å±±æœ­ã‹ã‚‰è¡¨ç¤ºã—ãŸã‚ˆ"
          : "æœªã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆåˆæœŸé †ï¼‰ã‹ã‚‰è¡¨ç¤ºã—ãŸã‚ˆï¼ˆå¿…è¦ãªã‚‰å…ˆã«ã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼‰",
        true
      );
    });

    $("copyInfoBtn").addEventListener("click", () => {
      if (!infoEl.value.trim()) {
        setStatus("å…ˆã«ã€Œã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹ã€ã‚’æŠ¼ã—ã¦ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆã—ã¦ã­ã€‚", false);
        return;
      }
      copyText(infoEl.value);
    });

    $("regenBtn").addEventListener("click", () => {
      const ok = regenerateInfo();
      if (!ok) {
        setStatus("ã¾ã ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã£ã¦ãªã„ã‚ˆã€‚å…ˆã«ã€Œã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹ã€ã‚’æŠ¼ã—ã¦ã­ã€‚", false);
        return;
      }
      setStatus("ã‚¤ãƒ³ãƒ•ã‚©ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†ç”Ÿæˆï¼ˆä¸Šæ›¸ãï¼‰ã—ãŸã‚ˆ", true);
    });

    setStatus("æœªã‚·ãƒ£ãƒƒãƒ•ãƒ«ï¼ˆåˆæœŸé †ï¼‰", true);
  </script>
</body>
</html>
